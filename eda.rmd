---
title: "Exploratory Data Analysis"
output: 
  html_document:
    toc: true
    toc_float: true
    code_folding: hide
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE,
  warning = FALSE,
  message = FALSE,
  dev.args = list(bg = "transparent")
  )
```

```{r}
library(tidyverse)
library(knitr)
library(lubridate)
library(ggcorrplot)
library(plotly)
library(scales)


steam_theme = theme_classic() + 
  theme(
    panel.background = element_rect(fill = "transparent", color = NA), 
    plot.background = element_rect(fill = "transparent", color = NA),
    legend.background = element_rect(fill = "transparent", color = NA),
    legend.box.background = element_rect(fill = "transparent", color = NA),
    text = element_text(color = "#66c0f4")
    )

theme_set(steam_theme)
steam_df = read_csv("data/clean_steam_games.csv")
```

In this exploratory data analysis, we want to understand what factors drive game popularity on Steam. We begin by exploring the distribution of the key outcome variable: `peak_ccu` (peak_concurrent users) along with their relationships to potential predictors such as playtime, price, release year, estimated owners, and genre/category information. In details, we are aiming to: 

- Identify general patterns in popularity 

- Assess data quality and transformations needed for modeling

- Detect early signals of which features might influence engagement

# Distribution of Peak Concurrent Users

```{r}
pccu_distribution = steam_df |>
  ggplot(aes(x = peak_ccu)) +
  geom_histogram(bins = 50, fill = "#66c0f4") +
  scale_x_continuous(trans = "log10") +
  labs(
    title = "Distribution of Peak Concurrent Users (Log Scale)",
    x = "Peak CCU"
  )

ggplotly(pccu_distribution)
```

Note that peak_ccu is heavily tailed. A tiny handful of games (like Counter-Strike 2, Dota 2, PUBG) have millions of CCU and owners, while the vast majority of games have very few owners and almost zero peak CCU. Applying log scales here allow us to compare games based on multiplicative differences rather than additive ones. For developers, the jump from 1,000 owners to 10,000 owners is just as significant as the jump from 100,000 to 1,000,000.

# Estimated Owners vs Popularity 

Owners represent the overall reach of a game while peak_ccu reflects active use. Games with high owner counts but low CCU may indicate weak long-term engagement. The plot below visualizes the correlation between estimated owners and peak CCU.

```{r}
eo_boxplot = steam_df |>
  ggplot(aes(x = factor(estimated_owners), y = peak_ccu)) +
  geom_boxplot(fill = "#66c0f4", alpha = 0.6, color = "#66c0f4") +
  scale_y_continuous(trans = "log10") +
  labs(
    title = "Distribution of Peak CCU by Owner Tier",
    x = "Estimated Owners Tier",
    y = "Peak CCU (Log Scale)"
  )

ggplotly(eo_boxplot)
```

In the lower tiers (left side), the whiskers are long, and outliers are everywhere. Performance is unpredictable. In the highest tiers ($1e+07$), the boxes are tighter. Namely, If you have 10 million owners, your CCU is predictably massive. There are very few "dead" games with 10 million owners.

# Free vs Paid Games

Free-to-play titles often follow different business models than paid games.Free-to-play games often mean a larger player base and higher expectations for popularity fluctuations, do free-to-play games have a higher CCU than paid games? Here we compare the distribution of popularity between free and paid games.

```{r,message=FALSE, warning=FALSE}
steam_free_paid = steam_df |>
  mutate(
    free_flag = if_else(price == 0, "Free", "Paid")
  )
free_paid_plot = steam_free_paid |>
  ggplot(aes(x = free_flag, y = peak_ccu)) +
  geom_boxplot(fill = "#66c0f4", alpha = 0.6, color = "#66c0f4") +
  scale_y_continuous(trans = "log10") +
  labs(
    title = "Free vs Paid Games Peak CCU ",
    x = "",
    y = "Peak CCU (log scale)"
  )

ggplotly(free_paid_plot)
```

The median peak CCU is similar for both free-to-play and paid games, indicating that there is no fundamental difference in popularity between typical free-to-play games and typical paid games.However, Free-to-play games have higher dispersion and more hit games. The longer upper bounds and more extreme outliers show that most of the most popular games on Steam (such as PUBG, CS2, and Apex Legends) are free-to-play. Paid games are more concentrated. Paid games can also be very popular, but their overall distribution is more compact, with less fluctuation in popularity

# Price Range and Game Popularity

Based on the above analysis, we further divide the price of paid games into different ranges to observe the median CCU at different price levels.

```{r ,message=FALSE, warning=FALSE}
steam_price_level <- steam_df |>
  mutate(
    price_level = case_when(
      price <= 4.99 ~ "$0.99–4.99",
      price <= 9.99 ~ "$5–9.99",
      price <= 19.99 ~ "$10–19.99",
      price <= 39.99 ~ "$20–39.99",
      price <= 59.99 ~ "$40–59.99",
      TRUE ~ "$60+"
    )
  )

price_median_plot <- steam_price_level |>
  group_by(price_level) |>
  summarize(
    median_ccu = median(peak_ccu),
    .groups = "drop"
  ) |>
  ggplot(aes(x = reorder(price_level, median_ccu), y = median_ccu)) +
  geom_col(fill = "#66c0f4", alpha = 0.8) +
  coord_flip() +
  scale_y_continuous(trans = "log10") +
  labs(
    title = "Median Peak CCU by Price Range",
    x = "Price Range",
    y = "Median Peak CCU (log scale)"
  )

ggplotly(price_median_plot)
```

We can see that the more expensive the game, the higher the median Peak CCU.This phenomenon isn't because players prefer expensive games, but rather because higher prices usually represent large-scale productions . These games are more competitive in terms of marketing and production quality, thus attracting more players. Conversely, games priced below $10 are typically indie games with a smaller target audience and limited market exposure, resulting in a naturally lower median popularity.

# User Satisfaction vs Popularity

Reviews reflect user satisfaction. If higher satisfaction correlates with higher playtime, review sentiment becomes a strong candidate predictor. Here, we define satisfaction with Review Ratio:
\[
RR = \frac{Positive}{Positive + Negative} 
\]

```{r}
rr_trend = steam_df |>
  mutate(
    total_reviews = positive + negative,
    review_ratio = positive / total_reviews
  ) |>
  filter(total_reviews > 50) |>
  ggplot(aes(x = review_ratio, y = peak_ccu)) +
  geom_point(alpha = 0.2, size = 0.8, color = "#66c0f4") +
  geom_smooth(method = "gam", color = "#e6e9f0", se = FALSE) +
  scale_y_log10(
    labels = label_number(accuracy = 1, big.mark = ","),
    breaks = trans_breaks("log10", function(x) 10^x)
  ) +
  scale_x_continuous(labels = scales::percent) +
  labs(
    title = "Review Ratio vs Peak CCU",
    x = "Positive Review Ratio",
    y = "Peak CCU"
  )

ggplotly(rr_trend)
```

The white trend line stays relatively flat for a long time and then curves upward sharply once the Review Ratio exceeds roughly 75%.
This implies that moving from a "Bad" game (25%) to a "Mediocre" game (50%) yields very little gain in popularity. However, moving from "Good" (75%) to "Excellent" (95%+) yields an significant increase in peak players.

# Popularity by Genre

Genres encapsulate game design choices, and identifying which genres drive deeper engagement is important for game developers. Below we list the top 15 most popular genres on Steam.

```{r}
genres_trend_plot = steam_df |>
  separate_rows(genres, sep = ",\\s*") |>
  filter(!genres %in% c("Free to Play", "Early Access")) |>
  group_by(genres) |>
  summarize(
    total_ccu = sum(peak_ccu, na.rm = TRUE),
    n_games = n()
  ) |>
  arrange(desc(total_ccu)) |>
  slice_head(n = 15) |>
  ggplot(aes(x = reorder(genres, total_ccu), 
             y = total_ccu,
             text = paste("Genre:", genres, 
                          "<br>Total CCU:", scales::comma(total_ccu),
                          "<br>Number of Games:", n_games))) +
  geom_col(fill = "#66c0f4") +
  coord_flip() +
  scale_y_continuous(labels = scales::comma) +
  labs(
    title = "Top Genres by Total Peak CCU",
    x = "Genre",
    y = "Total Peak CCU"
  )

ggplotly(genres_trend_plot, tooltip = "text")
```

The plot above gives very intuitive results, and the 5 most popular genres are: Action, Adventure, RPG(Role Play), Indie, and Simulation. Clicking on each bar will show the number of games in that genre. For developers, a bigger market (more CCU) is almost certainly filled with more competitors. RPG is a very special genre with 6,329,228 peak CCU but only 2590 games, as the cost of making a RPG is usually expensive.

# Developer Output and Productivity

Steam developers vary widely in scale, some studios release dozens of games, while others release only one. Here we examine:
1. Which developers publish the most games  
2. Which developers achieve the highest typical popularity 

```{r, message=FALSE, warning=FALSE}

dev_df <- steam_df |>
  separate_rows(developers, sep = ",\\s*")

dev_count_plot <- dev_df |>
  count(developers) |>
  arrange(desc(n)) |>
  slice_head(n = 15) |>
  ggplot(aes(x = reorder(developers, n), y = n)) +
  geom_col(fill = "#66c0f4") +
  coord_flip() +
  labs(
    title = "Top 15 Developers by Number of Games Published",
    x = "Developer",
    y = "Number of Games"
  )

ggplotly(dev_count_plot)

dev_quality_plot <- dev_df |>
  group_by(developers) |>
  summarize(
    n_games = n(),
    median_ccu = median(peak_ccu)
  ) |>
  filter(n_games >= 5) |>  
  arrange(desc(median_ccu)) |>
  slice_head(n = 15) |>
  ggplot(aes(x = reorder(developers, median_ccu), y = median_ccu)) +
  geom_col(fill = "#66c0f4") +
  coord_flip() +
  scale_y_continuous(trans = "log10") +
  labs(
    title = "Top Developers by Median Peak CCU ",
    x = "Developer",
    y = "Median Peak CCU (log scale)"
  )

ggplotly(dev_quality_plot)
```

# Correlation

Lastly, we use a correlation graph to check for potential predictors for our model.

```{r}
correlation_matrix = steam_df |>
  mutate(
    release_date = as.numeric(release_date),
    total_reviews = positive + negative,
    review_ratio = ifelse(total_reviews > 0, positive / total_reviews, 0),
    log_peak_ccu = log1p(peak_ccu),
    log_estimated_owners = log1p(estimated_owners),
    log_price = log1p(price),
    log_average_playtime = log1p(average_playtime)
  ) |>
  select(log_price, log_estimated_owners, release_date,
         log_peak_ccu, log_average_playtime, median_playtime,
         dlc_count, review_ratio) |>
  cor(use = "complete.obs") |>
  ggcorrplot(
    lab = FALSE, 
    hc.order = TRUE, 
    ggtheme = steam_theme,
    outline.color = "white",
    colors = c("#6D9EC1", "white", "#E46726"))

ggplotly(correlation_matrix)
```

From the correlation matrix and other plots, we find `peak_ccu` and most variables are weak linearly. Therefore, for our additional analysis, instead of performing a Linear Regression, we use a Random Forest regressor to unveil relationships and interactions. Details of our Random Forest Model can be found [here](modeling.html).